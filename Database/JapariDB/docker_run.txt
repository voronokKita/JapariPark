# Networking
docker network create -d overlay --attachable japari_data_net


# Build
# Context: the JapariDB base dir
DOCKER_BUILDKIT=1 \
    docker build \
            --secret id=japari_data_user_pass,src=./secrets/.docker-build.secret \
            --file Dockerfile \
            --tag japari_db \
            .


# Run
docker run --detach \
            --name JapariDB \
            -e POSTGRES_PASSWORD="$(cat ./secrets/.superuser_pass.secret)" \
            -p 5432:5432 \
            --network japari_data_net \
            --network-alias japari-db.api \
            -v "$(pwd)/data":/var/lib/postgresql/data \
            japari_db
